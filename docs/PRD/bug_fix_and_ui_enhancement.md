# Chrome下载管理插件Bug修复和UI美化需求文档

## 项目背景

用户报告了Chrome下载管理插件的多个问题，需要进行bug修复和UI美化。

---

## 用户报告问题

### 问题1: 右上角三点按钮无法关闭
**描述**: 点击三点菜单外部区域时，菜单无法正常关闭

**优先级**: P1

**修复方案**: 优化事件冒泡处理，确保`stopPropagation()`在正确时机调用

---

### 问题2: 列表有不显示的内容
**描述**: 列表区域出现大片灰色空白区域，内容不可见

**优先级**: P0

**修复方案**: 修复skeleton加载状态清理逻辑，确保timer正确释放

---

### 问题3: 缺少下载徽章提示
**描述**: 下载文件时，鼠标在浏览器内部，插件图标没有显示下载中的提示

**需求**: 显示一个带数字的徽章，标识当前有几个文件正在下载

**优先级**: P1

**实施方案**: 
- 创建background service worker
- 监听`chrome.downloads.onChanged`事件
- 使用`chrome.action.setBadgeText()`更新徽章

---

### 问题4: 文件类型图标大小不统一
**描述**: 不同文件类型的图标文字显示大小不一致

**优先级**: P2

**修复方案**: 统一设置icon字体大小为10px，字体粗细为700

---

### 问题5: UI风格普通
**需求**: 整体UI参考macOS设计风格，提升视觉品质

**优先级**: P1

**设计方向**:
- 使用macOS系统蓝(#007AFF)作为主色调
- 更大的圆角(16px)
- 柔和的多层阴影
- 毛玻璃效果(backdrop-filter)
- SF Pro字体风格
- 流畅的交互动画(0.3s ease)

---

## 技术实施

### 修改文件
1. `popup.js`: 修复bug，优化逻辑
2. `background.js`: 新建，实现徽章功能
3. `manifest.json`: 添加service worker配置
4. `popup.css`: 全面重写，实现macOS风格

### 关键技术点
- Manifest V3 Service Worker
- CSS backdrop-filter毛玻璃效果
- Chrome Extension Badge API
- CSS变量管理主题
- 防抖和事件优化

---

## 验收标准

1. ✅ 三点菜单可正常打开和关闭
2. ✅ 列表无灰色空白区域
3. ✅ 下载时扩展图标显示徽章数字
4. ✅ 所有文件图标视觉大小一致
5. ✅ UI呈现macOS精致风格
6. ✅ 深色模式完美适配
7. ✅ 所有交互动画流畅(0.3s)

---

## 风险评估

- **低风险**: CSS美化、图标统一
- **中风险**: Background service worker(需要测试调试)
- **兼容性**: backdrop-filter在某些Windows系统可能降级

---

## 时间估算

- Bug修复: 1小时
- Service Worker开发: 1.5小时
- UI美化: 2小时
- 测试验证: 1小时

**总计**: 约5.5小时

---

## 完成状态

✅ **已完成**: 所有功能已实现并通过验证
